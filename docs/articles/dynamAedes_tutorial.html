<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Describing the main features of *dynamAedes.m* • dynamAedes.m</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Describing the main features of *dynamAedes.m*">
<meta property="og:description" content="dynamAedes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynamAedes.m</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dynamAedes.m_tutorial.html">Describing the main features of *dynamAedes.m*</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mattmar/dynamAedes.m/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="dynamAedes.m_tutorial_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Describing the main features of <em>dynamAedes.m</em>
</h1>
                        <h4 data-toc-skip class="author">Daniele Da Re, Sophie 0. Vanwambeke, Matteo Marcantonio</h4>
            
            <h4 data-toc-skip class="date">2022-05-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mattmar/dynamAedes.m/blob/HEAD/../../vignettes/dynamAedes.m_tutorial.Rmd" class="external-link"><code>../../vignettes/dynamAedes.m_tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>dynamAedes.m_tutorial.Rmd</code></div>

    </div>

    
    
<p>This tutorial explains step-by-step the main features of <strong>dynamAedes.m</strong> package, a unified modelling framework for invasive <em>Aedes</em> mosquitoes. Users can apply the stochastic, time-discrete and spatially-explicit population dynamical model initially developed here <a href="https://doi.org/10.1016/j.ecoinf.2020.101180" class="external-link uri">https://doi.org/10.1016/j.ecoinf.2020.101180</a> for <em>Aedes aegypti</em> and then expanded for other three species: <em>Ae. albopictus</em>, <em>Ae. japonicus</em> and <em>Ae. koreicus</em> here: <a href="http://dx.doi.org/10.1101/2021.12.21.473628" class="external-link uri">http://dx.doi.org/10.1101/2021.12.21.473628</a> .</p>
<p>The model is driven by temperature, photoperiod and intra-specific larval competition and can be applied to three different spatial scales: punctual, local and regional. These spatial scales consider different degrees of spatial complexity and data availability, by accounting for both active and passive dispersal of the modelled mosquito species as well as for the heterogeneity of input temperature data.</p>
<p>We will describe model applications for <em>Ae. albopictus</em> and for all spatial scales by using a simulated temperature dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Load packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/" class="external-link">spatstat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/gstat/" class="external-link">gstat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://github.com/sakoehler7/eesim" class="external-link">eesim</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">geosphere</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/" class="external-link">rgeos</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">dynamAedes.m</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="punctual-scale-model">Punctual scale model<a class="anchor" aria-label="anchor" href="#punctual-scale-model"></a>
</h2>
<p>At punctual scale, the model only requires a weather station temperature time series provided as a numerical matrix (in degree Celsius). For the purpose of this tutorial, we simulate a 1-year long temperature time series.</p>
<div class="section level3">
<h3 id="simulate-temperature-data-with-seasonal-trend">Simulate temperature data with seasonal trend<a class="anchor" aria-label="anchor" href="#simulate-temperature-data-with-seasonal-trend"></a>
</h3>
<p>We first simulate a 1-year temperature time series with seasonal trend. For the time series we consider a mean value of 16°C and standard deviation of 2°C.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ndays</span> <span class="op">=</span> <span class="fl">365</span><span class="op">*</span><span class="fl">1</span> <span class="co">#length of the time series in days</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">sim_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/eesim/man/create_sims.html" class="external-link">create_sims</a></span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">1</span>, 
                        n <span class="op">=</span> <span class="va">ndays</span>, 
                        central <span class="op">=</span> <span class="fl">16</span>, 
                        sd <span class="op">=</span> <span class="fl">2</span>, 
                        exposure_type <span class="op">=</span> <span class="st">"continuous"</span>, 
                        exposure_trend <span class="op">=</span> <span class="st">"cos1"</span>, exposure_amp <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span>, 
                        average_outcome <span class="op">=</span> <span class="fl">12</span>,
                        outcome_trend <span class="op">=</span> <span class="st">"cos1"</span>,
                        outcome_amp <span class="op">=</span> <span class="fl">0.8</span>, 
                        rr <span class="op">=</span> <span class="fl">1.0055</span><span class="op">)</span></code></pre></div>
<p>A visualisation of the distribution of temperature values and temporal trend.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span>, 
     xlab<span class="op">=</span><span class="st">"Temperature (°C)"</span>, 
     main<span class="op">=</span><span class="st">"Histogram of simulated temperatures"</span><span class="op">)</span></code></pre></div>
<p><img src="dynamAedes.m_tutorial_files/figure-html/unnamed-chunk-4-1.png" width="95%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span>,
     <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span>,
     main<span class="op">=</span><span class="st">"Simulated temperatures seasonal trend"</span>, 
     xlab<span class="op">=</span><span class="st">"Date"</span>, ylab<span class="op">=</span><span class="st">"Temperature (°C)"</span>
     <span class="op">)</span></code></pre></div>
<p><img src="dynamAedes.m_tutorial_files/figure-html/unnamed-chunk-4-2.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="format-the-simulated-input-datasets-and-run-the-model">Format the simulated input datasets and run the model<a class="anchor" aria-label="anchor" href="#format-the-simulated-input-datasets-and-run-the-model"></a>
</h3>
<div class="section level4">
<h4 id="model-settings">Model settings<a class="anchor" aria-label="anchor" href="#model-settings"></a>
</h4>
<p>Float numbers in the temperature matrix would slow the computational speed, they must be multiplied by 1000 and then transformed in integer numbers. We also transpose the matrix from long to wide format, since we conceptualised the model structure considering the rows as the spatial component (e.g. observations; here = 1) and the columns as the temporal one (e.g. variables).</p>
<p>We are now left with a few model parameters which need to be defined by the user.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Define the day of introduction (August 1st is day 1)</span>
<span class="va">str</span> <span class="op">=</span> <span class="st">"2000-07-05"</span>
<span class="co">## Define the end-day of life cycle (September 1st is the last day)</span>
<span class="va">endr</span> <span class="op">=</span> <span class="st">"2000-08-05"</span>
<span class="co">## Define the number of eggs to be introduced</span>
<span class="va">ie</span> <span class="op">=</span> <span class="fl">1000</span>
<span class="co">## Define the number of model iterations</span>
<span class="va">it</span> <span class="op">=</span> <span class="fl">1</span> <span class="co"># The higher the number of simulations the better</span>
<span class="co">## Define the number of liters for the larval density-dependent mortality</span>
<span class="va">habitat_liters</span><span class="op">=</span><span class="fl">1</span>
<span class="co">#Define latitude and longitude for the diapause process</span>
<span class="va">myLat</span><span class="op">=</span><span class="fl">42</span>
<span class="va">myLon</span><span class="op">=</span><span class="fl">7</span>
<span class="co">## Define the number of parallel processes (for sequential itarations set nc=1)</span>
<span class="va">cl</span> <span class="op">=</span> <span class="fl">1</span>
<span class="co">## Set output name for the *.RDS output will be saved</span>
<span class="co">#outname= paste0("dynamAedes.m_albo_ws_dayintro_",str,"_end",endr,"_niters",it,"_neggs",ie)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Date"</span> <span class="op">=</span> <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span>, <span class="st">"temp"</span> <span class="op">=</span> <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
<span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">df_temp</span><span class="op">$</span><span class="va">temp</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">str</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>,<span class="st">"%j"</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">endr</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>,<span class="st">"%j"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="run-the-model">Run the model<a class="anchor" aria-label="anchor" href="#run-the-model"></a>
</h4>
<p>Running the model with the settings specified in this example takes about 2 minutes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simout</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dynamAedes.m.html">dynamAedes.m</a></span><span class="op">(</span>species<span class="op">=</span><span class="st">"albopictus"</span>, 
                     scale<span class="op">=</span><span class="st">"ws"</span>,  
                     ihwv<span class="op">=</span><span class="va">habitat_liters</span>,  
                     temps.matrix<span class="op">=</span><span class="va">w</span>,  
                     startd<span class="op">=</span><span class="va">str</span>, 
                     endd<span class="op">=</span><span class="va">endr</span>,  
                     n.clusters<span class="op">=</span><span class="va">cl</span>, 
                     iter<span class="op">=</span><span class="va">it</span>,  
                     intro.eggs<span class="op">=</span><span class="va">ie</span>,  
                     compressed.output<span class="op">=</span><span class="cn">TRUE</span>, 
                     lat<span class="op">=</span><span class="va">myLat</span>, 
                     long<span class="op">=</span><span class="va">myLon</span>,
                     verbose<span class="op">=</span><span class="cn">TRUE</span>,
                     seeding<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="analyse-the-results">Analyse the results<a class="anchor" aria-label="anchor" href="#analyse-the-results"></a>
</h3>
<p>We first explore the model output structure: the <em>simout</em> object is a nested list.</p>
<p>The <strong>first</strong> level corresponds to the number of model iterations</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># [1] 1</span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># [1] 1</span></code></pre>
<p>The <strong>second</strong> level corresponds to the simulated days. So if we inspect the first iteration, we observe that the model has computed 62 days, as we had specified above in the object <em>endr</em>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co"># [1] 30</span></code></pre>
<p>The <strong>third</strong> level corresponds to the amount of individuals for each stage (rows). So if we inspect the 1st and the 62th day within the first iteration, we obtain a matrix having</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">31</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>We can now use the auxiliary functions of the package to analyse the results.</p>
<div class="section level4">
<h4 id="derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period">Derive probability of a successfull introduction at the end of the simulated period<a class="anchor" aria-label="anchor" href="#derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period"></a>
</h4>
<p>First, we can retrieve the “probability of successful introduction”, computed as the proportion of model iterations that resulted in a viable mosquito population at a given date.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">31</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="derive-abundance-95-ci-for-each-life-stage-and-in-each-day">Derive abundance 95% CI for each life stage and in each day<a class="anchor" aria-label="anchor" href="#derive-abundance-95-ci-for-each-life-stage-and-in-each-day"></a>
</h4>
<p>We now compute the interquantile range abundance for all the stages of the simulated population using the function <em>adci</em>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">simout</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="co">#retrieve the maximum number of simulated days</span>
<span class="va">egg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">juv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">eggd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>

<span class="va">egg</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Egg"</span>
<span class="va">sta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">str</span><span class="op">)</span>,<span class="st">"%j"</span><span class="op">)</span><span class="op">)</span>
<span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">endr</span><span class="op">)</span>,<span class="st">"%j"</span><span class="op">)</span><span class="op">)</span>

<span class="va">egg</span><span class="op">$</span><span class="va">Date</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">sta</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">end</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">juv</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Juvenile"</span>
<span class="va">juv</span><span class="op">$</span><span class="va">Date</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">sta</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">end</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">ad</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Adult"</span>
<span class="va">ad</span><span class="op">$</span><span class="va">Date</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">sta</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">end</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">eggd</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Diapausing egg"</span>
<span class="va">eggd</span><span class="op">$</span><span class="va">Date</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">sta</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">end</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>

<span class="va">outdf</span><span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">egg</span>, <span class="va">juv</span>, <span class="va">ad</span>, <span class="va">eggd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">outdf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>myStage<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span>, levels<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Egg"</span>, <span class="st">"Diapausing egg"</span>, <span class="st">"Juvenile"</span>, <span class="st">"Adult"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="op">(</span><span class="va">`50%`</span><span class="op">)</span>,x<span class="op">=</span><span class="va">Date</span>, group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Ae. albopictus Interquantile range abundance"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">`25%`</span>,ymax<span class="op">=</span><span class="op">(</span><span class="va">`75%`</span><span class="op">)</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span><span class="op">)</span><span class="op">)</span>,
              col<span class="op">=</span><span class="st">"white"</span>,
              alpha<span class="op">=</span><span class="fl">0.2</span>,
              outline.type<span class="op">=</span><span class="st">"full"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Date"</span>, y<span class="op">=</span><span class="st">"Interquantile range abundance"</span>, col<span class="op">=</span><span class="st">"Stage"</span>, fill<span class="op">=</span><span class="st">"Stage"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">myStage</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.pos<span class="op">=</span><span class="st">"bottom"</span>,  text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> , strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="local-scale-model">Local scale model<a class="anchor" aria-label="anchor" href="#local-scale-model"></a>
</h2>
<p>The “local scale” means that the model accounts for both active and passive dispersal of the mosquitoes. With this setting, the model requires three input datasets: a numerical temperature matrix (in degree Celsius) defined in space and time (space in the rows, time in the columns), a two-column numerical matrix reporting the coordinates (in meters) of each space-unit (cell) and a numerical <em>distance matrix</em> which reports the distance in meters between the cells connected through a road network. For the purpose of this tutorial, we will use the following simulated datasets:</p>
<ol style="list-style-type: decimal">
<li>A 5 km lattice grid with 250 m cell size;</li>
<li>A 1-year long spatially and temporally correlated temperature time series;</li>
<li>A matrix of distances between cells connected through a simulated road network;</li>
</ol>
<div class="section level3">
<h3 id="prepare-input-data">Prepare input data<a class="anchor" aria-label="anchor" href="#prepare-input-data"></a>
</h3>
<div class="section level4">
<h4 id="create-lattice-arena">Create lattice arena<a class="anchor" aria-label="anchor" href="#create-lattice-arena"></a>
</h4>
<p>First, we define the physical space into which the introduction of our mosquitoes will happen. We define a squared lattice arena having 5 km side and 250 m resolution (20 colums and 20 rows, 400 total cells).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gridDim</span> <span class="op">&lt;-</span> <span class="fl">20</span> <span class="co"># 5000m/250 m = 20 columns and rows</span>
<span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">gridDim</span>, y<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">gridDim</span><span class="op">)</span></code></pre></div>
<p>We then add a spatial pattern into the lattice area. This spatial pattern will be used later to add spatial correllation (SAC) to the temperature time series. The spatial autocorrelated pattern will be obtained using a semivariogram model with defined sill (value that the semivarion attains at the range) and range (distance of 0 spatial correlation) and then predicting the semivariogram model over the lattice grid using unconditional Gaussian simulation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">varioMod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/vgm.html" class="external-link">vgm</a></span><span class="op">(</span>psill<span class="op">=</span><span class="fl">0.005</span>, range<span class="op">=</span><span class="fl">100</span>, model<span class="op">=</span><span class="st">'Exp'</span><span class="op">)</span> <span class="co"># psill = partial sill = (sill-nugget)</span>
<span class="co"># Set up an additional variable from simple kriging</span>
<span class="va">zDummy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/gstat.html" class="external-link">gstat</a></span><span class="op">(</span>formula<span class="op">=</span><span class="va">z</span><span class="op">~</span><span class="fl">1</span>, 
                locations <span class="op">=</span> <span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="va">y</span>, 
                dummy<span class="op">=</span><span class="cn">TRUE</span>,
                beta<span class="op">=</span><span class="fl">1</span>, 
                model<span class="op">=</span><span class="va">varioMod</span>, 
                nmax<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="co"># Generate a randomly autocorrelated predictor data field</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">xyz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/predict.gstat.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">zDummy</span>, newdata<span class="op">=</span><span class="va">xy</span>, nsim<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>We generate a spatially autocorrelated raster adding the SA variable (<em>xyz$sim1</em>) to the RasterLayer object. The autocorrelated surface could for example represent the distribution of vegetation cover in a urban landscape.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">utm32N</span> <span class="op">&lt;-</span> <span class="st">"+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span>
<span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="va">gridDim</span>, ncol<span class="op">=</span><span class="va">gridDim</span>, crs<span class="op">=</span><span class="va">utm32N</span>, ext<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html" class="external-link">extent</a></span><span class="op">(</span><span class="fl">1220000</span>,<span class="fl">1225000</span>, <span class="fl">5700000</span>,<span class="fl">5705000</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html" class="external-link">values</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">=</span><span class="va">xyz</span><span class="op">$</span><span class="va">sim1</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">xyz</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span>
<span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html" class="external-link">extent</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>

<span class="co"># Store Parameters for autocorrelation</span>
<span class="va">autocorr_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html" class="external-link">values</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="simulate-temperature-data-with-seasonal-trend-1">Simulate temperature data with seasonal trend<a class="anchor" aria-label="anchor" href="#simulate-temperature-data-with-seasonal-trend-1"></a>
</h4>
<p>We take advantage of the temperature dataset simulated for the punctual scale modelling exercise. We can then “expand onto space” the temperature time series by multiplying it with the autocorrelated surface simulated above.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">d_t</span> <span class="op">&lt;-</span> <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">*</span><span class="va">autocorr_factor</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">d_t</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="va">mat</span><span class="op">)</span></code></pre></div>
<p>A comparison between the distribution of the initial temperature time series and autocorrelated temperature surface</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mat</span>, xlab<span class="op">=</span><span class="st">"Temperature (°C)"</span>, main<span class="op">=</span><span class="st">"Histogram of simulated spatial autocorreled temperature"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span>, xlab<span class="op">=</span><span class="st">"Temperature (°C)"</span>, main<span class="op">=</span><span class="st">"Histogram of simulated temperatures"</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Format temperature data</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"d_"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">ndays</span><span class="op">)</span>
<span class="va">df_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">mat</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="simulate-an-arbitrary-road-segment-for-medium-range-dispersal">Simulate an arbitrary road segment for medium-range dispersal<a class="anchor" aria-label="anchor" href="#simulate-an-arbitrary-road-segment-for-medium-range-dispersal"></a>
</h3>
<p>In the model we have considered the possiblity of medium-range passive dispersal. Thus, we will simulate an arbitrary road segment along which adult mosquitoes can disperse passively (i.e., through car traffic).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/spsample.html" class="external-link">spsample</a></span><span class="op">(</span><span class="va">bbox</span>, <span class="fl">5</span>, type<span class="op">=</span><span class="st">"random"</span><span class="op">)</span>
<span class="va">roads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/spEasy.html" class="external-link">spLines</a></span><span class="op">(</span><span class="va">pts</span><span class="op">)</span>

<span class="co"># Check simulated segment</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">roads</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>After defining the road segment we add a “buffer” of 250 m around the road segment. Adult mosquitoes that reach or develop into cells comprised in the 250 m buffer around roads are thus able to undergo passive dispersal.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">buff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/buffer.html" class="external-link">buffer</a></span><span class="op">(</span><span class="va">roads</span>, width<span class="op">=</span><span class="fl">250</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">buff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="co"># Check grid, road segment and buffer</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">buff</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">roads</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p>Next, we derive a distance matrix between cells comprised in the spatial buffer along the road network. First, we select the cells.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sp</span> <span class="op">&lt;-</span> <span class="va">df</span>
<span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">df_sp</span><span class="op">)</span><span class="op">=</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="va">y</span>
<span class="va">df_sp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/intersect.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">df_sp</span>,<span class="va">buff</span><span class="op">)</span>

<span class="co"># Check selected cells</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">buff</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">df_sp</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p>Then, we compute the Euclidean distance between each selected cell.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dist_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">df_sp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="format-the-simulated-input-datasets-and-run-the-model-1">Format the simulated input datasets and run the model<a class="anchor" aria-label="anchor" href="#format-the-simulated-input-datasets-and-run-the-model-1"></a>
</h2>
<div class="section level3">
<h3 id="model-settings-1">Model settings<a class="anchor" aria-label="anchor" href="#model-settings-1"></a>
</h3>
<p>Float numbers in the temperature matrix would slow the computational speed, thus we first multiply them by 1000 and then transform them in integer numbers.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">df_temp</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can now define a two-column matrix of coordinates to identify each cell in the lattice grid.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cc</span> <span class="op">&lt;-</span> <span class="va">df_temp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>As for model requirement, the distance matrix must have column names equal to row names.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dist_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">dist_matrix</span><span class="op">)</span></code></pre></div>
<p>Moreover, distances in the distance matrix must be rounded to the thousands.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dist_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">dist_matrix</span>,<span class="fl">2</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">1000</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span> 

<span class="co"># An histogram showing the distribution of distances of cells along the road network</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">dist_matrix</span>, xlab<span class="op">=</span><span class="st">"Distance (meters)"</span><span class="op">)</span></code></pre></div>
<p>Select a cell that intersect roads for introduction:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">icellcoords</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">dist_matrix</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">icellid</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">dist_matrix</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span>

<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">buff</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">df_sp</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html" class="external-link">SpatialPoints</a></span><span class="op">(</span><span class="va">icellcoords</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"blue"</span>, pch<span class="op">=</span><span class="fl">21</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html" class="external-link">SpatialPoints</a></span><span class="op">(</span>coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">[</span><span class="va">icellid</span>,<span class="op">]</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"black"</span>, pch<span class="op">=</span><span class="fl">21</span><span class="op">)</span></code></pre></div>
<p>We are now left with a few model variables which need to be defined.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Define cells along roads into which introduce propagules on day 1</span>
<span class="va">intro.vector</span> <span class="op">&lt;-</span> <span class="va">icellid</span>
<span class="co">## Define the day of introduction (August 1st is day 1)</span>
<span class="va">str</span> <span class="op">=</span> <span class="st">"2018-04-01"</span>
<span class="co">## Define the end-day of life cycle (October 1st is the last day)</span>
<span class="va">endr</span> <span class="op">=</span> <span class="st">"2018-05-01"</span>
<span class="co">## Define the number of adult females to be introduced</span>
<span class="va">ia</span> <span class="op">=</span> <span class="fl">5000</span>
<span class="co">## Define the number of model iterations</span>
<span class="va">it</span> <span class="op">=</span> <span class="fl">1</span> <span class="co"># The higher the number of simulations the better</span>
<span class="co">## Define the number of liters for the larval density-dependent mortality</span>
<span class="va">habitat_liters</span><span class="op">=</span><span class="fl">1</span>
<span class="co">#Define latitude and longitude for the diapause process</span>
<span class="va">myLat</span><span class="op">=</span><span class="fl">42</span>
<span class="va">myLon</span><span class="op">=</span><span class="fl">7</span>
<span class="co">##Define average trip distance (in km)</span>
<span class="va">mypDist</span><span class="op">=</span><span class="fl">2</span>
<span class="co">## Define the number of parallel processes (for sequential iterations set nc=1)</span>
<span class="va">cl</span> <span class="op">=</span> <span class="fl">1</span></code></pre></div>
<div class="section level4">
<h4 id="run-the-model-1">Run the model<a class="anchor" aria-label="anchor" href="#run-the-model-1"></a>
</h4>
<p>Running the model with the settings specified in this example takes about 3 minutes.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simout</span><span class="op">=</span><span class="fu"><a href="../reference/dynamAedes.m.html">dynamAedes.m</a></span><span class="op">(</span>species<span class="op">=</span><span class="st">"albopictus"</span>,
            scale<span class="op">=</span><span class="st">"lc"</span>,  
            ihwv<span class="op">=</span><span class="va">habitat_liters</span>,  
            temps.matrix<span class="op">=</span><span class="va">w</span>,
            cells.coords<span class="op">=</span><span class="va">cc</span>,
            road.dist.matrix<span class="op">=</span><span class="va">dist_matrix</span>,
            avgpdisp<span class="op">=</span><span class="va">mypDist</span>,
            intro.cells<span class="op">=</span><span class="va">intro.vector</span>,
            startd<span class="op">=</span><span class="va">str</span>, 
            endd<span class="op">=</span><span class="va">endr</span>,  
            n.clusters<span class="op">=</span><span class="va">cl</span>, 
            iter<span class="op">=</span><span class="va">it</span>,  
            intro.adults<span class="op">=</span><span class="va">ia</span>,  
            compressed.output<span class="op">=</span><span class="cn">TRUE</span>, 
            cellsize<span class="op">=</span><span class="fl">250</span>,
            maxadisp<span class="op">=</span><span class="fl">600</span>,
            dispbins<span class="op">=</span><span class="fl">10</span>,
            seeding<span class="op">=</span><span class="cn">TRUE</span>,
            verbose<span class="op">=</span> <span class="cn">FALSE</span>
            <span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="analyse-the-results-1">Analyse the results<a class="anchor" aria-label="anchor" href="#analyse-the-results-1"></a>
</h3>
<p>We first explore the model output structure: the <em>simout</em> object is a nested list.</p>
<p>The <strong>first</strong> level corresponds to the number of model iterations</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The <strong>second</strong> level corresponds to the simulated days. So if we inspect the first iteration, we observe that the model has computed 123 days, as we had specified above in the object <em>endr</em>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>The <strong>third</strong> level corresponds to the amount of individuals for each stage (rows) within each grid cell of the landscape (columns). So if we inspect the first day within the first iteration, we obtain a matrix having:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>We can now use the auxiliary functions of the model to Analyse the results.</p>
<div class="section level4">
<h4 id="derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period-1">Derive probability of a successfull introduction at the end of the simulated period<a class="anchor" aria-label="anchor" href="#derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period-1"></a>
</h4>
<p>First, we can retrieve the probability of successful introduction, computed as the proportion of model iterations that resulted in a viable mosquito population at a given date.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></code></pre></div>
<p>We can also get a spatial output, using the function <em>psi_sp</em>, which require as additional input only the matrix of centroid coordinates of pixels.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/psi_sp.html">psi_sp</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="va">cc</span>, input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">61</span>, n.clusters<span class="op">=</span><span class="va">cl</span><span class="op">)</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">buff</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">df_sp</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html" class="external-link">SpatialPoints</a></span><span class="op">(</span><span class="va">icellcoords</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"blue"</span>, pch<span class="op">=</span><span class="fl">21</span><span class="op">)</span></code></pre></div>
<p>At local scale, the interpretation of this output is more nuanced than for the other scales: a pixel having psi=0 can be a pixel where all the simulations resulted in an extinction or where the species has not yet arrived through dispersal.</p>
</div>
<div class="section level4">
<h4 id="derive-abundance-95-ci-for-each-life-stage-and-in-each-day-1">Derive abundance 95% CI for each life stage and in each day<a class="anchor" aria-label="anchor" href="#derive-abundance-95-ci-for-each-life-stage-and-in-each-day-1"></a>
</h4>
<p>We can now compute the interquantile range abundance of the simulated population over the whole landscape using the function <em>adci</em>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">simout</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="co">#retrieve the maximum number of simulated days</span>
<span class="va">egg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">juv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">eggd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>

<span class="va">egg</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Egg"</span>
<span class="va">egg</span><span class="op">$</span><span class="va">Date</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">str</span><span class="op">]</span>, <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">endr</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">juv</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Juvenile"</span>
<span class="va">juv</span><span class="op">$</span><span class="va">Date</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">str</span><span class="op">]</span>, <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">endr</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">ad</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Adult"</span>
<span class="va">ad</span><span class="op">$</span><span class="va">Date</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">str</span><span class="op">]</span>, <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">endr</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">eggd</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Diapausing egg"</span>
<span class="va">eggd</span><span class="op">$</span><span class="va">Date</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">str</span><span class="op">]</span>, <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="va">endr</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>

<span class="va">outdf</span><span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">egg</span>, <span class="va">juv</span>, <span class="va">ad</span>, <span class="va">eggd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">outdf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>myStage<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span>, levels<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Egg"</span>, <span class="st">"Diapausing egg"</span>, <span class="st">"Juvenile"</span>, <span class="st">"Adult"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">`50%`</span>,x<span class="op">=</span><span class="va">Date</span>, group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Ae. albopictus Interquantile range abundance"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">`25%`</span>,ymax<span class="op">=</span><span class="va">`75%`</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span><span class="op">)</span><span class="op">)</span>,
              col<span class="op">=</span><span class="st">"white"</span>,
              alpha<span class="op">=</span><span class="fl">0.2</span>,
              outline.type<span class="op">=</span><span class="st">"full"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Date"</span>, y<span class="op">=</span><span class="st">"Interquantile range abundance (Log10)"</span>, col<span class="op">=</span><span class="st">"Stage"</span>, fill<span class="op">=</span><span class="st">"Stage"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">myStage</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.pos<span class="op">=</span><span class="st">"bottom"</span>,  text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> , strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can also have a spatial output of quantiles of the abundance distribution of a given life stage and for a given simulated day by using the function <em>adci_sp</em> and specifiying pixel coordinates. For example for eggs:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">r</span><span class="op">=</span><span class="fu"><a href="../reference/adci_sp.html">adci_sp</a></span><span class="op">(</span><span class="va">simout</span>, coords<span class="op">=</span><span class="va">cc</span>, eval_date<span class="op">=</span><span class="fl">61</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.975</span><span class="op">)</span>, stage<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></code></pre></div>
<p>Note that if only a small number of mosquitoes are present in a pixel over many iterations, quantiles may be 0 (especially for low quantiles) and you may see a series of empty rasters!</p>
</div>
<div class="section level4">
<h4 id="number-of-invaded-cells">Number of invaded cells<a class="anchor" aria-label="anchor" href="#number-of-invaded-cells"></a>
</h4>
<p>Compute a summary of the number of invaded cells over model iterations</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">=</span><span class="fu"><a href="../reference/icci.html">icci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">61</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimates-of-mosquito-dispersal-spread-in-km2">Estimates of mosquito dispersal spread (in km2 )<a class="anchor" aria-label="anchor" href="#estimates-of-mosquito-dispersal-spread-in-km2"></a>
</h4>
<p>Derive estimates of mosquito dispersal (in km^2) of the simulated mosquito populations (only when scale = “lc”) for any simulated day (in this case for 50 days from start and end of the simulate period).</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">=</span><span class="fu"><a href="../reference/dici.html">dici</a></span><span class="op">(</span><span class="va">simout</span>, coords<span class="op">=</span><span class="va">cc</span>, eval_date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">61</span>,length.out<span class="op">=</span><span class="fl">61</span><span class="op">)</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, space<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">`75%`</span><span class="op">~</span><span class="va">day</span>,<span class="va">x</span>,type<span class="op">=</span><span class="st">"l"</span>,ylab<span class="op">=</span><span class="st">"Population dispersal (in meters) from cell of introduction"</span>,xlab<span class="op">=</span><span class="st">"days from introduction"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">`50%`</span><span class="op">~</span><span class="va">day</span>,<span class="va">x</span>,type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">`25%`</span><span class="op">~</span><span class="va">day</span>,<span class="va">x</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="regional-scale-model">Regional scale model<a class="anchor" aria-label="anchor" href="#regional-scale-model"></a>
</h2>
<p>The model at regional scale is the same as running the model at “punctual” scale for each cell of the grid but without accounting for active or passive dispersal. Each cell is therefore a close unit or mosquito population. With this setting, the model requires two input datasets: a numerical temperature matrix (in degree Celsius) defined in space and time (space in the rows, time in the columns), and a two-column numerical matrix reporting the centroid coordinates (in meters) of each cell. For the purpose of this tutorial, we will use the following simulated datasets:</p>
<ol style="list-style-type: decimal">
<li>A 5 km lattice grid with 250 m cell size;</li>
<li>A 1-year long spatially and temporally correlated temperature time series;</li>
</ol>
<div class="section level3">
<h3 id="model-settings-2">Model settings<a class="anchor" aria-label="anchor" href="#model-settings-2"></a>
</h3>
<p>We take advantage of the spatial temperature dataset simulated for the local scale example.</p>
<p>Float numbers in the temperature matrix would slow the computational speed, thus we first multiply them by 1000 and then transform them in integer numbers.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">df_temp</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can now define a two-column matrix of coordinates to identify each cell in the lattice grid.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cc</span> <span class="op">&lt;-</span> <span class="va">df_temp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>We are now left with a few model variables which need to be defined.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Define the day of introduction (June 1st is day 1)</span>
<span class="va">str</span> <span class="op">=</span> <span class="st">"2018-05-01"</span>
<span class="co">## Define the end-day of life cycle (October 1st is the last day)</span>
<span class="va">endr</span> <span class="op">=</span> <span class="st">"2018-05-10"</span>
<span class="co">## Define the number of eggs to be introduced</span>
<span class="va">ie</span> <span class="op">=</span> <span class="fl">100</span>
<span class="co">## Define the number of model iterations</span>
<span class="va">it</span> <span class="op">=</span> <span class="fl">1</span> <span class="co"># The higher the number of simulations the better</span>
<span class="co">## Define the number of liters for the larval density-dependent mortality</span>
<span class="va">habitat_liters</span><span class="op">=</span><span class="fl">1</span>
<span class="co">## Define the number of parallel processes (for sequential iterations set nc=1)</span>
<span class="va">cl</span> <span class="op">=</span> <span class="fl">1</span></code></pre></div>
<div class="section level4">
<h4 id="run-the-model-2">Run the model<a class="anchor" aria-label="anchor" href="#run-the-model-2"></a>
</h4>
<p>Running the model with the settings specified in this example takes about 3 minutes.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simout</span><span class="op">=</span><span class="fu"><a href="../reference/dynamAedes.m.html">dynamAedes.m</a></span><span class="op">(</span>species<span class="op">=</span><span class="st">"albopictus"</span>, 
            scale<span class="op">=</span><span class="st">"rg"</span>,  
            ihwv<span class="op">=</span><span class="va">habitat_liters</span>,  
            temps.matrix<span class="op">=</span><span class="va">w</span>,  
            cells.coords<span class="op">=</span><span class="va">cc</span>,
            startd<span class="op">=</span><span class="va">str</span>, 
            endd<span class="op">=</span><span class="va">endr</span>,  
            n.clusters<span class="op">=</span><span class="va">cl</span>, 
            iter<span class="op">=</span><span class="va">it</span>,  
            intro.eggs<span class="op">=</span><span class="va">ie</span>,  
            compressed.output<span class="op">=</span><span class="cn">TRUE</span>, 
            verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="analyse-the-results-2">Analyse the results<a class="anchor" aria-label="anchor" href="#analyse-the-results-2"></a>
</h3>
<p>We first explore model output structure: the <em>simout</em> object is a nested list.</p>
<p>The <strong>first</strong> level corresponds to the number of model iterations</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The <strong>second</strong> level corresponds to the simulated days. If we inspect the first iteration, we observe that the model run for 123 days, as we had specified above in the object <em>endr</em>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>The <strong>third</strong> level of the output list object corresponds to the amount of individuals for each stage (rows) within each grid cell of the landscape (columns). If we inspect the first day within the first iteration, we obtain a matrix having</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>We can now use the auxiliary functions of the package to Analyse the results.</p>
<div class="section level4">
<h4 id="derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period-2">Derive probability of a successfull introduction at the end of the simulated period<a class="anchor" aria-label="anchor" href="#derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period-2"></a>
</h4>
<p>First, we can retrieve the “probability of a successful introduction”, computed as the proportion of model iterations that resulted in a viable mosquito population (in any cells of the grid) at a given date.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></code></pre></div>
<p>We can also get a “spatial output”, using the function <em>psi_sp</em>, which requires as additional input only the matrix of the pixels coordinates</p>
</div>
<div class="section level4">
<h4 id="derive-abundance-95-ci-for-each-life-stage-and-in-each-day-2">Derive abundance 95% CI for each life stage and in each day<a class="anchor" aria-label="anchor" href="#derive-abundance-95-ci-for-each-life-stage-and-in-each-day-2"></a>
</h4>
<p>We can now compute the interquantile range abundance of the simulated population using the function <em>adci</em> over the whole landscape.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">simout</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="co">#retrieve the maximum number of simulated days</span>
<span class="va">egg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">juv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">eggd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/adci.html">adci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">dd</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, st<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>

<span class="va">egg</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Egg"</span>
<span class="va">juv</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Juvenile"</span>
<span class="va">ad</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Adult"</span>
<span class="va">eggd</span><span class="op">$</span><span class="va">myStage</span><span class="op">=</span><span class="st">"Diapausing egg"</span>

<span class="va">outdf</span><span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">egg</span>, <span class="va">juv</span>, <span class="va">ad</span>, <span class="va">eggd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">outdf</span><span class="op">$</span><span class="va">Date</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">str</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">str</span><span class="op">)</span><span class="op">+</span><span class="va">dd</span><span class="op">-</span><span class="fl">1</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>,<span class="fl">4</span><span class="op">)</span>

<span class="va">outdf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>myStage<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span>, levels<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Egg"</span>, <span class="st">"Diapausing egg"</span>, <span class="st">"Juvenile"</span>, <span class="st">"Adult"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="op">(</span><span class="va">`50%`</span><span class="op">)</span>,x<span class="op">=</span><span class="va">Date</span>, group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Ae. albopictus Interquantile range abundance"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">`25%`</span>,ymax<span class="op">=</span><span class="op">(</span><span class="va">`75%`</span><span class="op">)</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">myStage</span><span class="op">)</span><span class="op">)</span>,
              col<span class="op">=</span><span class="st">"white"</span>,
              alpha<span class="op">=</span><span class="fl">0.2</span>,
              outline.type<span class="op">=</span><span class="st">"full"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Date"</span>, y<span class="op">=</span><span class="st">"Interquantile range abundance"</span>, col<span class="op">=</span><span class="st">"Stage"</span>, fill<span class="op">=</span><span class="st">"Stage"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">myStage</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.pos<span class="op">=</span><span class="st">"bottom"</span>,  text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> , strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="dynamAedes.m_tutorial_files/figure-html/unnamed-chunk-47-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matteo Marcantonio, Daniele Da Re.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
