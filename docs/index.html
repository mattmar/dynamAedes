<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Unified Mechanistic Model for the Population Dynamics of Invasive Aedes Mosquitoes • dynamAedes</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="A Unified Mechanistic Model for the Population Dynamics of Invasive Aedes Mosquitoes">
<meta property="og:description" content="Generalised model for population dynamics of invasive Aedes mosquitoes. Rationale and model structure are described here: &lt;doi:10.1016/j.ecoinf.2020.101180&gt; and &lt;doi:10.1101/2021.12.21.473628&gt; .">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">dynamAedes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/dynamAedes_tutorial.html">Describing the main features of *dynamAedes*</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mattmar/dynamAedes/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<p><code>{r setup, include=FALSE} knitr::opts_chunk$set(echo = TRUE)</code> This tutorial provides a step-by-step guide to the <strong>dynamAedes</strong> package, a unified modelling framework for invasive <em>Aedes</em> mosquitoes. In this package, the users can apply the stochastic, time-discrete and spatially-explicit population dynamical model developed in Da Re et. al 2021 (DOI: <a href="https://doi.org/10.1016/j.ecoinf.2020.101180" class="external-link uri">https://doi.org/10.1016/j.ecoinf.2020.101180</a>) for <em>Aedes aegypti</em> mosquitoes and now expanded for other three species: <em>Ae. albopictus</em>, <em>Ae. japonicus</em> and <em>Ae. koreicus</em></p>
<p>This stage-based model is informed by temperature and photoperiod and can be applied to three different spatial scales: punctual, local and regional. These spatial scales consider different degrees of spatial complexity and data availability, by accounting for both active and passive dispersal of the modeled mosquito species as well as for the heterogeneity of temperature data.</p>
<p>We will present the application of each scale of the model using a simulated temperature dataset for the species <em>Ae. albopictus</em></p>
<p><code>{r, echo=FALSE, results='hide',message=FALSE} setwd("/home/ddare/working_files/aedes_eu/testing_pkg/") Sys.setlocale("LC_TIME", "en_GB.UTF-8")</code> ```{r, results=‘hide’,message=FALSE} #Packages for processing library(raster) library(sp) library(gstat) library(spatstat) library(maptools) library(rgeos) library(parallel) library(eesim) library(tidyverse) library(dynamAedes)</p>
<p>#Packages for plotting library(ggplot2) library(geosphere)</p>
<pre><code>
# Punctual scale model
At punctual scale the model only requires a weather station temperature time series provided as a numerical matrix with temperatures in Celsius. For the purpose of this tutorial, we will simulate a 2-year long temperature time series.

## Simulate temperature data with seasonal trend
Next, we simulate a two-year temperature time series with seasonal trend. For the time series we consider a mean value of 18°C and standard deviation of 3°C.

```{r}
ndays = 365*3 #length of the time series in days
set.seed(123)
sim_temp &lt;- create_sims(n_reps = 1, 
                        n = ndays, 
                        central = 18, 
                        sd = 2, 
                        exposure_type = "continuous", 
                        exposure_trend = "cos1", exposure_amp = -.3, 
                        average_outcome = 12,
                        outcome_trend = "cos1",
                        outcome_amp = 0.8, 
                        rr = 1.0005)</code></pre>
<p>A visualisation of the temperature values distribution and the “average” temporal trend.</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span>, 
     xlab<span class="op">=</span><span class="st">"Temperature (°C)"</span>, 
     main<span class="op">=</span><span class="st">"Histogram of simulated temperatures"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span>,
     <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span>,
     main<span class="op">=</span><span class="st">"Simulated temperatures seasonal trend"</span>, 
     xlab<span class="op">=</span><span class="st">"Date"</span>, ylab<span class="op">=</span><span class="st">"Temperature (°C)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">35</span><span class="op">)</span><span class="op">)</span></code></pre>
<div class="section level2">
<h2 id="format-the-simulated-input-datasets-and-run-the-model">Format the simulated input datasets and run the model<a class="anchor" aria-label="anchor" href="#format-the-simulated-input-datasets-and-run-the-model"></a>
</h2>
<div class="section level3">
<h3 id="model-settings">Model settings<a class="anchor" aria-label="anchor" href="#model-settings"></a>
</h3>
<p>Float numbers in the temperature matrix would slow the computational speed, thus we first multiply them by 1000 and then transform them in integer numbers. We also transpose the matrix from long to wide format, because we conceptualize the module structure considering the rows as the spatial component (here = 1) and the columns as the temporal one.</p>
<pre class="{r}"><code><span class="va">df_temp</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Date"</span> <span class="op">=</span> <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span>, <span class="st">"temp"</span> <span class="op">=</span> <span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
<span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">df_temp</span><span class="op">$</span><span class="va">temp</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></code></pre>
<p>We are now left with a few model parameters which need to be defined.</p>
<pre class="{r}"><code><span class="co">## Define the day of introduction (day 1)</span>
<span class="va">str</span> <span class="op">=</span> <span class="fl">121</span>
<span class="co">## Define the end-day of life cycle</span>
<span class="va">endr</span> <span class="op">=</span> <span class="fl">121</span><span class="op">+</span><span class="fl">365</span>
<span class="co">## Define the number of eggs to be introduced</span>
<span class="va">ie</span> <span class="op">=</span> <span class="fl">500</span>
<span class="co">## Define the number of model iterations</span>
<span class="va">it</span> <span class="op">=</span> <span class="fl">10</span> <span class="co"># The higher the number of simulation the better</span>
<span class="co">## Define the number of liters for the larval density-dependent mortality</span>
<span class="va">habitat_liters</span><span class="op">=</span><span class="fl">1</span>
<span class="co">#Define latitude and longitude for the diapause process</span>
<span class="va">myLat</span><span class="op">=</span><span class="fl">42</span>
<span class="va">myLon</span><span class="op">=</span><span class="fl">7</span>
<span class="co">## Define the number of parallel processes (for sequential itarations set nc=1)</span>
<span class="va">cl</span> <span class="op">=</span> <span class="fl">5</span>
<span class="co">## Set output name for the *.RDS output will be saved</span>
<span class="va">outname</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"dynamAedes_albo_ws_dayintro_"</span>,<span class="va">str</span>,<span class="st">"_end"</span>,<span class="va">endr</span>,<span class="st">"_niters"</span>,<span class="va">it</span>,<span class="st">"_neggs"</span>,<span class="va">ie</span><span class="op">)</span></code></pre>
</div>
<div class="section level3">
<h3 id="run-the-model">Run the model<a class="anchor" aria-label="anchor" href="#run-the-model"></a>
</h3>
<p>Running the model takes around 10 minutes with the settings specified in this example. <code>{r, eval=FALSE, echo=TRUE} simout=dynamAedes(species="albopictus",                       scale="ws",                        ihwv=habitat_liters,                        temps.matrix=w,                        startd=str,                       endd=endr,                        n.clusters=cl,                       iter=it,                        intro.eggs=ie,                        compressed.output=TRUE,                       lat=myLat,                       long=myLon,                       suffix=outname,                       verbose = FALSE)</code> ## Analyze the results <code>{r, echo=FALSE, results='hide',message=FALSE} simout=readRDS("dynamAedes_albo_ws_dayintro_121_end486_niters10_neggs500.RDS")</code></p>
<p>We first explore the model output structure: the <em>simout</em> object is a nested list.</p>
<p>The <strong>first</strong> level corresponds to the number of model iterations</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">)</span><span class="op">)</span></code></pre>
<p>The <strong>second</strong> level corresponds to the simulated days. So if we inspect the first iteration, we will observe that the model has computed 366 days, as we had specified above in the object <em>endr</em>.</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre>
<p>The <strong>third</strong> level corresponds to the amount of individuals for each stage (rows). So if we inspect the 1st and the 50th day within the first iteration, we will obtain a matrix having</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">50</span><span class="op">]</span><span class="op">]</span></code></pre>
<p>We can now use the auxiliary functions of the model to analyze the results.</p>
</div>
<div class="section level3">
<h3 id="derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period">Derive probability of a successfull introduction at the end of the simulated period<a class="anchor" aria-label="anchor" href="#derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period"></a>
</h3>
<p>First, we can retrieve the probability of successful introduction, computed as the proportion of model iterations that resulted in a viable mosquito population at a given date for a given life stage.</p>
<p><code>{r, eval=FALSE, echo=TRUE} rbind.data.frame(psi(input_sim = simout, eval_date = 300, stage = 0),                  psi(input_sim = simout, eval_date = 340, stage = 1),                  psi(input_sim = simout, eval_date = 300, stage = 2),                  psi(input_sim = simout, eval_date = 300, stage = 3))</code></p>
</div>
<div class="section level3">
<h3 id="derive-abundance-95-ci-for-each-life-stage-and-in-each-day">Derive abundance 95% CI for each life stage and in each day<a class="anchor" aria-label="anchor" href="#derive-abundance-95-ci-for-each-life-stage-and-in-each-day"></a>
</h3>
<p>We can now compute the interquantile range abundance of the simulated population using the function <em>adci</em>. ```{r, eval=FALSE, echo=TRUE} dd &lt;- max(sapply(simout, function(x) length(x)))#retrieve the maximum number of simulated days egg&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=1)) juv&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=2)) ad&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=3)) eggd&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=4))</p>
<p>egg<span class="math inline">$myStage="Egg" egg$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”) juv<span class="math inline">$myStage="Juvenile" juv$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”) ad<span class="math inline">$myStage="Adult" ad$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”) eggd<span class="math inline">$myStage="Diapausing egg" eggd$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”)</p>
<p>outdf=bind_rows(egg, juv, ad, eggd) %&gt;% as_tibble()</p>
<p>outdf %&gt;% mutate(myStage=factor(myStage, levels= c(“Egg”, “Diapausing egg”, “Juvenile”, “Adult”))) %&gt;% ggplot( aes(y=(<code>50%</code>),x=Date, group=factor(myStage),col=factor(myStage))) + ggtitle(“Ae. albopictus Interquantile range abundance”)+ geom_line(size=1.2)+ geom_ribbon(aes(ymin=<code>25%</code>,ymax=(<code>75%</code>),fill=factor(myStage)), col=“white”, alpha=0.2, outline.type=“full”)+ labs(x=“Date”, y=“Interquantile range abundance”, col=“Stage”, fill=“Stage”)+ facet_wrap(~myStage, scales = “free”)+ theme_light()+ theme(legend.pos=“bottom”, text = element_text(size=14) , strip.text = element_text(face = “italic”))</p>
<pre><code># Local scale model
The local scale allows the model to account for both active and passive dispersal of the mosquitoes. With this setting, the model requires three input datasets: a numerical matrix with temperatures in Celsius defined in space and time (space in the rows, time in the columns), a two-column numerical matrix reporting the coordinates (in meters) of each space-unit (cell) and a numerical *distance matrix* which reports the distance in meters between the cells connected through a road network. For the purpose of this tutorial, we will use the following simulated datasets:

  1. A 10 km lattice grid with 250 m cell size; 
  2. A 2-year long spatially and temporally correlated temperature time series; 
  3. A matrix of distances between cells connected through a simulated road network; 

## Prepare input data
### Create lattice arena
First, we define the physical space where the introduction of our mosquitoes will happen. 
We define a squared lattice arena having 10 km side and 250 m resolution (40 colums and 40 rows, 1600 total cells).

```{r}
gridDim &lt;- 40 # 10000m/250 m = 40 columns and rows
xy &lt;- expand.grid(x=1:gridDim, y=1:gridDim)</code></pre>
<p>We then add a spatial pattern into the lattice area. This spatial pattern will be used later to add spatial correllation (SAC) to the temperature time series. The spatial autocorrelated pattern will be obtained using a semivariogram model with defined sill (value that the semivarion attains at the range) and range (distance of 0 spatial correlation) and then predicting the semivariogram model over the lattice grid using unconditional Gaussian simulation.</p>
<p><code>{r, message=FALSE} varioMod &lt;- vgm(psill=0.005, range=100, model='Exp') # psill = partial sill = (sill-nugget) # Set up an additional variable from simple kriging zDummy &lt;- gstat(formula=z~1,                  locations = ~x+y,                  dummy=TRUE,                 beta=1,                  model=varioMod,                  nmax=1) # Generate a randomly autocorrelated predictor data field set.seed(123) xyz &lt;- predict(zDummy, newdata=xy, nsim=1)</code></p>
<p>We generate a spatially autocorrelated raster adding the SA variable (*xyz<span class="math inline">$sim1*) to the RasterLayer object. The autocorrelated surface could for example represent the distribution of vegetation cover in a urban landscape. ```{r} utm32N &lt;- "+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs" r &lt;- raster(nrow=40, ncol=40, crs=utm32N, ext=extent(0,10000, 0,10000)) values(r)=xyz$</span>sim1 plot(r)</p>
<p>df &lt;- data.frame(“id”=1:nrow(xyz), coordinates(r)) bbox &lt;- as(extent(r), “SpatialPolygons”)</p>
</div>
</div>
<div class="section level1">
<div class="page-header"><h1 id="store-parameters-for-autocorrelation">Store Parameters for autocorrelation<a class="anchor" aria-label="anchor" href="#store-parameters-for-autocorrelation"></a>
</h1></div>
<p>autocorr_factor &lt;- values(r)</p>
<pre><code>### Simulate temperature data with seasonal trend
We take advantage of the temperature dataset simulated for the punctual scale modelling exercise. We can then "expand onto space" the temperature time series by multiplying it with the autocorrelated surface simulated above. 
```{r}
mat &lt;- mclapply(1:ncell(r), function(x) {
    d_t &lt;- sim_temp[[1]]$x*autocorr_factor[[x]]
    return(d_t)
},mc.cores=1) #mc.cores=1 in Windows OS, which does not support mclapply function

mat &lt;- do.call(rbind,mat)</code></pre>
<p>A comparison between the distribution of the initial temperature time series and autocorrelated temperature surface</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mat</span>, xlab<span class="op">=</span><span class="st">"Temperature (°C)"</span>, main<span class="op">=</span><span class="st">"Histogram of simulated temperatures with spatial autocorrelation"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">sim_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span>, xlab<span class="op">=</span><span class="st">"Temperature (°C)"</span>, main<span class="op">=</span><span class="st">"Histogram of simulated temperatures"</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Format temperature data</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"d_"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">ndays</span><span class="op">)</span>
<span class="va">df_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">mat</span><span class="op">)</span></code></pre>
<div class="section level2">
<h2 id="simulate-an-arbitrary-road-segment-for-medium-range-dispersal">Simulate an arbitrary road segment for medium-range dispersal<a class="anchor" aria-label="anchor" href="#simulate-an-arbitrary-road-segment-for-medium-range-dispersal"></a>
</h2>
<p>In the model we have considered the possiblity of medium-range passive dispersal. Thus, we will simulate an arbitrary road segment along which adult mosquitoes can disperse passively (i.e., thorugh car traffic).</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu">spsample</span><span class="op">(</span><span class="va">bbox</span>, <span class="fl">5</span>, type<span class="op">=</span><span class="st">"random"</span><span class="op">)</span>
<span class="va">roads</span> <span class="op">&lt;-</span> <span class="fu">spLines</span><span class="op">(</span><span class="va">pts</span><span class="op">)</span>

<span class="co"># Check simulated segment</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">roads</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre>
<p>After defining the road segment we will add a “buffer” of 100 m around the road segment. Adult mosquitoes that reach or develop into cells comprised in the 100 m buffer around roads will be able to undergo passive dispersal.</p>
<pre class="{r}"><code><span class="va">buff</span> <span class="op">&lt;-</span> <span class="fu">buffer</span><span class="op">(</span><span class="va">roads</span>, width<span class="op">=</span><span class="fl">100</span><span class="op">)</span>
<span class="fu">crs</span><span class="op">(</span><span class="va">buff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">crs</span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="co"># Check grid, road segment and buffer</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">buff</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">roads</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre>
<p>Next, we derive a distance matrix between cells comprised in the spatial buffer along the road network. First, we select the cells. ```{r, message=FALSE} df_sp=df coordinates(df_sp)=~x+y df_sp=raster::intersect(df_sp,buff)</p>
</div>
</div>
<div class="section level1">
<h1 id="check-selected-cells">Check selected cells<a class="anchor" aria-label="anchor" href="#check-selected-cells"></a>
</h1>
<p>raster::plot(r) raster::plot(buff, add=T) raster::plot(df_sp, add=T, col=“red”)</p>
<pre><code>
Then, we compute the Euclidean distance between each selected cell.
```{r}
dist_matrix &lt;- as.matrix(dist(coordinates(df_sp)))</code></pre>
</div>
<div class="section level1">
<h1 id="format-the-simulated-input-datasets-and-run-the-model-1">Format the simulated input datasets and run the model<a class="anchor" aria-label="anchor" href="#format-the-simulated-input-datasets-and-run-the-model-1"></a>
</h1>
<div class="section level2">
<h2 id="model-settings-1">Model settings<a class="anchor" aria-label="anchor" href="#model-settings-1"></a>
</h2>
<p>Float numbers in the temperature matrix would slow the computational speed, thus we first multiply them by 1000 and then transform them in integer numbers.</p>
<pre class="{r}"><code><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">df_temp</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></code></pre>
<p>We can now define a two-column matrix of coordinates to identify each cell in the lattice grid.</p>
<pre class="{r}"><code><span class="va">cc</span> <span class="op">&lt;-</span> <span class="va">df_temp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">]</span></code></pre>
<p>As for model requirement, the distance matrix must have column names equal to row names.</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dist_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">dist_matrix</span><span class="op">)</span></code></pre>
<p>Moreover, distances in the distance matrix must be rounded to the thousands.</p>
<pre class="{r}"><code><span class="va">dist_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">dist_matrix</span>,<span class="fl">2</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">1000</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span> 

<span class="co"># An histogram showing the distribution of distances of cells along the road network</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">dist_matrix</span>, xlab<span class="op">=</span><span class="st">"Distance (meters)"</span><span class="op">)</span></code></pre>
<p>We are now left with a few model variables which need to be defined.</p>
<pre class="{r}"><code><span class="co">## Define cells into which introduce propagules on day 1</span>
<span class="va">intro.vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">dist_matrix</span><span class="op">)</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>
<span class="co">## Define the day of introduction (day 1)</span>
<span class="va">str</span> <span class="op">=</span> <span class="fl">121</span>
<span class="co">## Define the end-day of life cycle</span>
<span class="va">endr</span> <span class="op">=</span> <span class="fl">121</span><span class="op">+</span><span class="op">(</span><span class="fl">365</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>
<span class="co">## Define the number of eggs to be introduced</span>
<span class="va">ie</span> <span class="op">=</span> <span class="fl">500</span>
<span class="co">## Define the number of model iterations</span>
<span class="va">it</span> <span class="op">=</span> <span class="fl">10</span> <span class="co"># The higher the number of simulation the better</span>
<span class="co">## Define the number of liters for the larval density-dependent mortality</span>
<span class="va">habitat_liters</span><span class="op">=</span><span class="fl">1</span>
<span class="co">#Define latitude and longitude for the diapause process</span>
<span class="va">myLat</span><span class="op">=</span><span class="fl">42</span>
<span class="va">myLon</span><span class="op">=</span><span class="fl">7</span>
<span class="co">##Define average trip distance </span>
<span class="va">myCountry</span><span class="op">=</span><span class="st">"fra"</span>
<span class="co">## Define the number of parallel processes (for sequential itarations set nc=1)</span>
<span class="va">cl</span> <span class="op">=</span> <span class="fl">5</span>
<span class="co">## Set output name for the *.RDS output will be saved</span>
<span class="va">outname</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"dynamAedes_albo_lc_dayintro_"</span>,<span class="va">str</span>,<span class="st">"_end"</span>,<span class="va">endr</span>,<span class="st">"_niters"</span>,<span class="va">it</span>,<span class="st">"_neggs"</span>,<span class="va">ie</span><span class="op">)</span></code></pre>
<div class="section level3">
<h3 id="run-the-model-1">Run the model<a class="anchor" aria-label="anchor" href="#run-the-model-1"></a>
</h3>
<p>Running the model takes around 15 minutes with the settings specified in this example. <code>{r, eval=FALSE, echo=TRUE} simout=dynamAedes(species="albopictus",             scale="lc",               ihwv=habitat_liters,               temps.matrix=w,               cells.coords=cc,             road.dist.matrix=dist_matrix,             intro.cells=intro.vector,             startd=str,              endd=endr,               n.clusters=cl,              iter=it,               intro.eggs=ie,               compressed.output=TRUE,              lat=myLat,              long=myLon,              country=myCountry,             suffix=outname,              verbose = FALSE)</code> ## Analyze the results <code>{r, echo=FALSE, results='hide',message=FALSE} simout=readRDS("dynamAedes_albo_lc_dayintro_121_end851_niters10_neggs500.RDS")</code> We first explore the model output structure: the <em>simout</em> object is a nested list.</p>
<p>The <strong>first</strong> level corresponds to the number of model iterations</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">)</span><span class="op">)</span></code></pre>
<p>The <strong>second</strong> level corresponds to the simulated days. So if we inspect the first iteration, we will observe that the model has computed 366 days, as we had specified above in the object <em>endr</em>.</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre>
<p>The <strong>third</strong> level corresponds to the amount of individuals for each stage (rows) within each grid cell of the landscape (columns). So if we inspect the first day within the first iteration, we will obtain a matrix having</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre>
<p>We can now use the auxiliary functions of the model to analyze the results.</p>
</div>
<div class="section level3">
<h3 id="derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period-1">Derive probability of a successfull introduction at the end of the simulated period<a class="anchor" aria-label="anchor" href="#derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period-1"></a>
</h3>
<p>First, we can retrieve the probability of successful introduction, computed as the proportion of model iterations that resulted in a viable mosquito population at a given date for a given life stage.</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind.data.frame</a></span><span class="op">(</span><span class="fu"><a href="reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">300</span>, stage <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
                 <span class="fu"><a href="reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">700</span>, stage <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                 <span class="fu"><a href="reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">700</span>, stage <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                 <span class="fu"><a href="reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">700</span>, stage <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre>
<p>We can also get a spatial output, using the function <em>psi_sp</em>, which require as additional input only the matrix of the pixels coordinates, b</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="reference/psi_sp.html">psi_sp</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="va">cc</span>, input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">600</span>, n.clusters<span class="op">=</span><span class="va">cl</span><span class="op">)</span><span class="op">)</span></code></pre>
<p>At local scale, this output has a double interpretation: a pixel having psi=0 can be a pixel where all the simulations resulted in an existinsions or where the species has not arrived yet through dispersal.</p>
</div>
<div class="section level3">
<h3 id="derive-abundance-95-ci-for-each-life-stage-and-in-each-day-1">Derive abundance 95% CI for each life stage and in each day<a class="anchor" aria-label="anchor" href="#derive-abundance-95-ci-for-each-life-stage-and-in-each-day-1"></a>
</h3>
<p>We can now compute the interquantile range abundance of the simulated population over the whole landscape using the function <em>adci</em> over the whole landscape. ```{r, eval=FALSE, echo=TRUE} dd &lt;- max(sapply(simout, function(x) length(x)))#retrieve the maximum number of simulated days egg&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=1)) juv&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=2)) ad&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=3)) eggd&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=4))</p>
<p>egg<span class="math inline">$myStage="Egg" egg$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”) juv<span class="math inline">$myStage="Juvenile" juv$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”) ad<span class="math inline">$myStage="Adult" ad$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”) eggd<span class="math inline">$myStage="Diapausing egg" eggd$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”)</p>
<p>outdf=bind_rows(egg, juv, ad, eggd) %&gt;% as_tibble()</p>
<p>outdf %&gt;% mutate(myStage=factor(myStage, levels= c(“Egg”, “Diapausing egg”, “Juvenile”, “Adult”))) %&gt;% ggplot( aes(y=log1p(<code>50%</code>),x=Date, group=factor(myStage),col=factor(myStage))) + ggtitle(“Ae. albopictus Interquantile range abundance”)+ geom_line(size=1.2)+ geom_ribbon(aes(ymin=log1p(<code>25%</code>),ymax=log1p(<code>75%</code>),fill=factor(myStage)), col=“white”, alpha=0.2, outline.type=“full”)+ labs(x=“Date”, y=“Interquantile range abundance (Log10)”, col=“Stage”, fill=“Stage”)+ facet_wrap(~myStage, scales = “free”)+ theme_light()+ theme(legend.pos=“bottom”, text = element_text(size=14) , strip.text = element_text(face = “italic”))</p>
<pre><code>
We can also have a spatial output of the estimated interquantile range abundance of a given life stage using the function *adci_sp* just specifiying the pixels coordinates. 

```{r}
r=adci_sp(simout, coords=cc, eval_date=700, breaks=c(0.25,0.50,0.75), stage=3)
plot(r)
</code></pre>
<p>Note that if only a small number of mosquitoes are present in the pixels, the lower quantiles (e.g., the 1st and the 2nd quartiles) will be zero.</p>
</div>
<div class="section level3">
<h3 id="number-of-invaded-cells">Number of invaded cells<a class="anchor" aria-label="anchor" href="#number-of-invaded-cells"></a>
</h3>
<p>Compute a summary of the number of invaded cells over model iterations</p>
<pre class="{r}"><code><span class="va">x</span><span class="op">=</span><span class="fu"><a href="reference/icci.html">icci</a></span><span class="op">(</span><span class="va">simout</span>, eval_date<span class="op">=</span><span class="fl">700</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span></code></pre>
</div>
<div class="section level3">
<h3 id="estimates-of-mosquito-dispersal-spread-in-km2-">Estimates of mosquito dispersal spread (in km2 )<a class="anchor" aria-label="anchor" href="#estimates-of-mosquito-dispersal-spread-in-km2-"></a>
</h3>
<p>Estimates of mosquito dispersal spread (in km2 ) of the simulated mosquito populations when scale = “lc”</p>
<pre class="{r}"><code><span class="va">x</span><span class="op">=</span><span class="fu"><a href="reference/dici.html">dici</a></span><span class="op">(</span><span class="va">simout</span>, coords<span class="op">=</span><span class="va">cc</span>, eval_date<span class="op">=</span><span class="fl">365</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span><span class="op">)</span>, space<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre>
</div>
</div>
</div>
<div class="section level1">
<h1 id="regional-scale-model">Regional scale model<a class="anchor" aria-label="anchor" href="#regional-scale-model"></a>
</h1>
<p>Essentialy, the regional scale model run a punctual model within each grid cell of the landscape, without accounting for both active and passive dispersal of the mosquitoes. With this setting, the model requires two input datasets: a numerical matrix with temperatures in Celsius defined in space and time (space in the rows, time in the columns), and a two-column numerical matrix reporting the coordinates (in meters) of each space-unit (cell). For the purpose of this tutorial, we will use the following simulated datasets:</p>
<ol style="list-style-type: decimal">
<li>A 10 km lattice grid with 250 m cell size;</li>
<li>A 2-year long spatially and temporally correlated temperature time series;</li>
</ol>
<div class="section level2">
<h2 id="model-settings-2">Model settings<a class="anchor" aria-label="anchor" href="#model-settings-2"></a>
</h2>
<p>We take advantage of the spatial temperature dataset simulated for the local scale modelling exercise.</p>
<p>Float numbers in the temperature matrix would slow the computational speed, thus we first multiply them by 1000 and then transform them in integer numbers.</p>
<pre class="{r}"><code><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">df_temp</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></code></pre>
<p>We can now define a two-column matrix of coordinates to identify each cell in the lattice grid.</p>
<pre class="{r}"><code><span class="va">cc</span> <span class="op">&lt;-</span> <span class="va">df_temp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">]</span></code></pre>
<p>We are now left with a few model variables which need to be defined.</p>
<pre class="{r}"><code><span class="co">## Define the day of introduction (day 1)</span>
<span class="va">str</span> <span class="op">=</span> <span class="fl">121</span>
<span class="co">## Define the end-day of life cycle</span>
<span class="va">endr</span> <span class="op">=</span> <span class="fl">121</span><span class="op">+</span><span class="fl">365</span>
<span class="co">## Define the number of eggs to be introduced</span>
<span class="va">ie</span> <span class="op">=</span> <span class="fl">500</span>
<span class="co">## Define the number of model iterations</span>
<span class="va">it</span> <span class="op">=</span> <span class="fl">10</span> <span class="co"># The higher the number of simulation the better</span>
<span class="co">## Define the number of liters for the larval density-dependent mortality</span>
<span class="va">habitat_liters</span><span class="op">=</span><span class="fl">1</span>
<span class="co">#Define latitude and longitude for the diapause process</span>
<span class="va">myLat</span><span class="op">=</span><span class="fl">42</span>
<span class="va">myLon</span><span class="op">=</span><span class="fl">7</span>
<span class="co">## Define the number of parallel processes (for sequential iterations set nc=1)</span>
<span class="va">cl</span> <span class="op">=</span> <span class="fl">5</span>
<span class="co">## Set output name for the *.RDS output will be saved</span>
<span class="va">outname</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"dynamAedes_albo_rg_dayintro_"</span>,<span class="va">str</span>,<span class="st">"_end"</span>,<span class="va">endr</span>,<span class="st">"_niters"</span>,<span class="va">it</span>,<span class="st">"_neggs"</span>,<span class="va">ie</span><span class="op">)</span></code></pre>
<div class="section level3">
<h3 id="run-the-model-2">Run the model<a class="anchor" aria-label="anchor" href="#run-the-model-2"></a>
</h3>
<p>Running the model takes around 10 minutes with the settings specified in this example. <code>{r, eval=FALSE, echo=TRUE} simout=dynamAedes(species="albopictus",              scale="rg",               ihwv=habitat_liters,               temps.matrix=w,               cells.coords=cc,             startd=str,              endd=endr,               n.clusters=cl,              iter=it,               intro.eggs=ie,               compressed.output=TRUE,              lat=myLat,              long=myLon,              suffix=outname,              verbose = FALSE)</code> ## Analyze the results <code>{r, echo=FALSE, results='hide',message=FALSE} simout=readRDS("dynamAedes_albo_rg_dayintro_121_end486_niters10_neggs500.RDS")</code> We first explore the model output structure: the <em>simout</em> object is a nested list.</p>
<p>The <strong>first</strong> level corresponds to the number of model iterations</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">)</span><span class="op">)</span></code></pre>
<p>The <strong>second</strong> level corresponds to the simulated days. So if we inspect the first iteration, we will observe that the model has computed 366 days, as we had specified above in the object <em>endr</em>.</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre>
<p>The <strong>third</strong> level corresponds to the amount of individuals for each stage (rows) within each grid cell of the landscape (columns). So if we inspect the first day within the first iteration, we will obtain a matrix having</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">simout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre>
<p>We can now use the auxiliary functions of the model to analyze the results.</p>
</div>
<div class="section level3">
<h3 id="derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period-2">Derive probability of a successfull introduction at the end of the simulated period<a class="anchor" aria-label="anchor" href="#derive-probability-of-a-successfull-introduction-at-the-end-of-the-simulated-period-2"></a>
</h3>
<p>First, we can retrieve the probability of successful introduction, computed as the proportion of model iterations that resulted in a viable mosquito population at a given date for a given life stage.</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind.data.frame</a></span><span class="op">(</span><span class="fu"><a href="reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">365</span>, stage <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
                 <span class="fu"><a href="reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">365</span>, stage <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                 <span class="fu"><a href="reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">365</span>, stage <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                 <span class="fu"><a href="reference/psi.html">psi</a></span><span class="op">(</span>input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">365</span>, stage <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre>
<p>We can also get a spatial output, using the function <em>psi_sp</em>, which require as additional input only the matrix of the pixels coordinates, b</p>
<pre class="{r}"><code><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="reference/psi_sp.html">psi_sp</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="va">cc</span>, input_sim <span class="op">=</span> <span class="va">simout</span>, eval_date <span class="op">=</span> <span class="fl">100</span>, np<span class="op">=</span><span class="va">cl</span><span class="op">)</span><span class="op">)</span></code></pre>
</div>
<div class="section level3">
<h3 id="derive-abundance-95-ci-for-each-life-stage-and-in-each-day-2">Derive abundance 95% CI for each life stage and in each day<a class="anchor" aria-label="anchor" href="#derive-abundance-95-ci-for-each-life-stage-and-in-each-day-2"></a>
</h3>
<p>We can now compute the interquantile range abundance of the simulated population using the function <em>adci</em> over the whole landscape. ```{r, eval=FALSE, echo=TRUE} dd &lt;- max(sapply(simout, function(x) length(x)))#retrieve the maximum number of simulated days egg&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=1)) juv&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=2)) ad&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=3)) eggd&lt;-as.data.frame(adci(simout, eval_date=1:dd, breaks=c(0.25,0.50,0.75), st=4))</p>
<p>egg<span class="math inline">$myStage="Egg" egg$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”) juv<span class="math inline">$myStage="Juvenile" juv$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”) ad<span class="math inline">$myStage="Adult" ad$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”) eggd<span class="math inline">$myStage="Diapausing egg" eggd$</span>Date=seq.Date(sim_temp[[1]]<span class="math inline"><em>d</em><em>a</em><em>t</em><em>e</em>[<em>s</em><em>t</em><em>r</em>], <em>s</em><em>i</em><em>m</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em>[[1]]</span>date[endr], by=“day”)</p>
<p>outdf=bind_rows(egg, juv, ad, eggd) %&gt;% as_tibble()</p>
<p>outdf %&gt;% mutate(myStage=factor(myStage, levels= c(“Egg”, “Diapausing egg”, “Juvenile”, “Adult”))) %&gt;% ggplot( aes(y=(<code>50%</code>),x=Date, group=factor(myStage),col=factor(myStage))) + ggtitle(“Ae. albopictus Interquantile range abundance”)+ geom_line(size=1.2)+ geom_ribbon(aes(ymin=<code>25%</code>,ymax=(<code>75%</code>),fill=factor(myStage)), col=“white”, alpha=0.2, outline.type=“full”)+ labs(x=“Date”, y=“Interquantile range abundance”, col=“Stage”, fill=“Stage”)+ facet_wrap(~myStage, scales = “free”)+ theme_light()+ theme(legend.pos=“bottom”, text = element_text(size=14) , strip.text = element_text(face = “italic”)) ```</p>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=dynamAedes" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/mattmar/dynamAedes/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mattmar/dynamAedes" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL(&gt;=2)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing dynamAedes</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Matteo Marcantonio <br><small class="roles"> Author, maintainer </small>  </li>
<li>Daniele Da Re <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Matteo Marcantonio, Daniele Da Re.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
